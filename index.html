<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>谷歌邮箱接码助手</title>
    <link rel="icon" href="favicon.png" type="image/png">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>

    <div class="app">
        <!-- 顶部控制栏 -->
        <div class="top-nav">
            <button class="btn-icon-text" id="btn-settings" title="API 设置">配置</button>
            <div id="status-bar" class="status-top">正在连接平台...</div>
            <div class="balance-display" id="balance-wrap" style="display:none;">
                <span class="balance-label">余额:</span>
                <span id="user-balance" class="balance-val">0.00</span>
            </div>
        </div>

        <!-- 核心展示区：当前号码 -->
        <div class="main-card">
            <div class="card-header">
                <span>当前可用号码</span>
                <button class="btn-text" id="btn-get-phone" disabled>获取新号码</button>
            </div>

            <div class="phone-hero">
                <span class="the-number" id="phone-display">---</span>
                <div class="phone-hero-actions">
                    <span class="price-tag">3.3元/次</span>
                    <button class="btn-icon-text" id="btn-copy" style="display:none;" title="复制号码">复制</button>
                </div>
            </div>

            <div class="phone-meta" id="phone-meta" style="display:none;">
                <div class="meta-bind">
                    <span class="bind-label">绑定邮箱:</span>
                    <span id="pinned-email-display" class="bind-value">未绑定</span>
                    <button class="btn-text small" id="btn-pin">修改绑定</button>
                </div>
                <div class="meta-actions">
                    <button class="btn-text danger small" id="btn-black">拉黑号码</button>
                </div>
            </div>
        </div>

        <!-- 短信与记录区 -->
        <div class="sms-section">
            <div class="section-header">
                <h3>短信记录</h3>
                <div class="poll-anim" id="poll-indicator">
                    <span class="dot"></span> 接收中
                </div>
            </div>

            <div id="sms-list" class="sms-list">
                <div class="empty-state">暂无短信，等待接收...</div>
            </div>
        </div>

        <div class="history-section">
            <div class="section-header">
                <h3>历史已绑号码</h3>
                <button class="btn-text" id="btn-export-json">导出备份</button>
            </div>
            <div id="pinned-list" class="pinned-list">
                <!-- 历史记录将渲染在这里 -->
            </div>
        </div>

    </div>

    <!-- 绑定邮箱模态框 -->
    <div id="pin-modal" class="modal-overlay">
        <div class="modal">
            <h3 class="modal-title">为号码绑定对应邮箱</h3>
            <p class="modal-desc">号码：<span id="modal-phone-display" class="modal-phone"></span></p>

            <div class="input-group" style="margin-bottom: 24px;">
                <label class="input-label">绑定谷歌邮箱 (只需填写前缀)</label>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <input type="text" id="modal-email-input" placeholder="输入前缀" style="flex: 1;" autocomplete="off">
                    <span style="color: var(--text-light); font-weight: 500;">@gmail.com</span>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn-flat" id="btn-modal-cancel">取消</button>
                <button class="btn-primary" id="btn-modal-confirm">保存绑定</button>
            </div>
        </div>
    </div>

    <!-- API 配置模态框 -->
    <div id="settings-modal" class="modal-overlay">
        <div class="modal">
            <h3 class="modal-title">平台 API 配置</h3>
            <p class="modal-desc">请填入豪猪网的对接凭证信息</p>

            <div class="input-group" style="margin-bottom: 12px;">
                <label class="input-label">API 账号名</label>
                <input type="text" id="set-api-user" placeholder="输入账号名">
            </div>
            <div class="input-group" style="margin-bottom: 20px;">
                <label class="input-label">API 密码</label>
                <input type="password" id="set-api-pass" placeholder="输入密码">
            </div>
            <div class="input-group" style="margin-bottom: 20px;">
                <label class="input-label">项目对接码</label>
                <input type="text" id="set-api-code" placeholder="如 28209-xxxx">
            </div>

            <div class="modal-actions">
                <button class="btn-flat" id="btn-set-cancel">取消</button>
                <button class="btn-primary" id="btn-set-confirm">保存配置</button>
            </div>
        </div>
    </div>

    <!-- 刷新重新获取提示模态框 -->
    <div id="reload-modal" class="modal-overlay">
        <div class="modal">
            <h3 class="modal-title">发现未完成的号码</h3>
            <p class="modal-desc" style="margin-bottom: 24px;">您已刷新页面。<br>是否重新获取并继续监听以下号码？</p>
            <div class="the-number" id="reload-phone-display" style="font-size: 24px; margin-bottom: 24px;">---</div>
            <div class="modal-actions">
                <button class="btn-flat" id="btn-reload-cancel">释放不用了</button>
                <button class="btn-primary" id="btn-reload-confirm">重新获取</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // 控制顶部提示条和按钮显示
        const observer = new MutationObserver(() => {
            const phoneEl = document.getElementById('phone-display');
            const copyBtn = document.getElementById('btn-copy');
            const phoneMeta = document.getElementById('phone-meta');
            const hasPhone = phoneEl.textContent !== '---' && phoneEl.textContent !== '获取中...';

            copyBtn.style.display = hasPhone ? 'inline-flex' : 'none';
            phoneMeta.style.display = hasPhone ? 'flex' : 'none';
        });
        observer.observe(document.getElementById('phone-display'), { childList: true, characterData: true, subtree: true });
    </script>
</body>

</html>